{% extends 'base.html' %}
{% block title %}Vendor sign up{% endblock %}
{% block body %}

{% if 'login' in session and 'edit' not in session or 'login' not in session %}
    <h1>Create vendor account</h1>
    <hr>
{% endif %}
{#session.get('edit') is used instead of session['edit'] to avoid a KeyError if the edit key is not present in the session dictionary.#}
{% if 'login' in session and session.get('edit') == True%}
    <h1>Edit account</h1>
    <hr>
{% endif %}

{% for message in get_flashed_messages() %}
        <h1 id="message">{{message}}</h1>
{% endfor %}

<form action="/vendorpage" id="vendor-form" method="POST" enctype="multipart/form-data">
    <div id="containter-form">
        <label for="vendorName">Business Name</label><br>
        <input type="text" name="vendorName" id="vendorName"><br>

        <label for="address">Address</label><br>
        <input type="text" name="address" id="address"><br>

        <label for="hours">Hours</label><br>
        <input type="text" name="hours" id="hours"><br>

        <label for="image">image</label><br>
		<input type="text" name="image" id="image"><br>

        <label for="zipcode">Zipcode</label><br>
        <input type="number" name="zipcode" id="zipcode"><br>


        <label for="state">State</label><br>
        <input type="text" name="state" id="state"><br>

        <label for="city">City</label><br>
        <input type="text" name="city" id="city"><br>

        <input type="hidden" id="coordinates" name="coordinates">
        
        {% if 'login' in session and 'edit' not in session or 'login' not in session %}
            <button type="submit">Sign up</button>
        {% endif %}
        {#session.get('edit') is used instead of session['edit'] to avoid a KeyError if the edit key is not present in the session dictionary.#}
        {% if 'login' in session and session.get('edit') == True%}
            <button type="submit">Edit</button>
        {% endif %}
        
    </div>
</form>
{% if 'login' in session and session.get('edit') == True%}
    <p>or</p>
    <p>Delete account</p>
    <a href="/deleteVendorAccount"><button>Delete</button></a>
 {% endif %}


    
<script>
    window.addEventListener('load', function() {
        const form = document.getElementById('vendor-form');
        form.addEventListener('submit', function(event) {
            event.preventDefault(); // prevent form submission

            const apiKey = 'AIzaSyBeoOdd3zdS3zAfqGFF7o6X8N3hGvsa04o';
            const address = document.getElementById('address').value;

            fetch(`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(address)}&key=${apiKey}`)
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'OK') {
                        const location = data.results[0].geometry.location;
                        const coordinates = [location.lat, location.lng];
                        console.log(coordinates);
                        document.getElementById('coordinates').value = coordinates.join(',');
                        form.submit(); // submit the form after getting the coordinates
                    } else {
                        console.log(`Error: ${data.status}`);
                    }
                })
                .catch(error => console.log('Error:', error));
        });
    });
</script>
{% endblock %}