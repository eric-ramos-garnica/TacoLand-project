
{% extends 'base.html'%}
{% block title %}Vendors page {% endblock %}

{% block head %}
<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
{% endblock %}

{% block body %}
<!-- jinja arrays -->
{% set my_list = [] %}
{% set business_name = []%}
{% set vendorId = []%}
{% set hours = []%}
{% set taco_icons = []%}

<h1>All Vendors</h1>
<!-- /filters by vendor type -->
<div id="container-filter-business-type">
  <a href="/filtervendors/taco truck"><button >Taco trucks</button></a>
  <a href="/filtervendors/taco stand"><button >Taco stands</button></a>
  <a href="/filtervendors/all"><button >All taco vendors</button></a>
  <img class="filter-image" src="https://img.icons8.com/external-tanah-basah-glyph-tanah-basah/48/null/external-filter-design-thinking-tanah-basah-glyph-tanah-basah.png"/>
</div>

<div id="container-filters" class="container-filter-display">
  <form action="/filterByZipcodeAndCity" method="GET">

    <label for="zipcode:">Zipcode:</label>
    <input type="number" name="zipcode" id="zipcode">
    <label for="city">City:</label>
    <input type="text" name="city" id="city"><br>
    <input type="radio" name="business_type_filter" id="Taco-trucks" value="taco truck">
    <label for="Taco-trucks">Taco trucks</label>
    <input type="radio" name="business_type_filter" id="Taco-stands" value="taco stand">
    <label for="Taco-stands">Taco stands</label>
    <input type="radio" name="business_type_filter" id="all" value="all" required>
    <label for="all">All vendors</label>
    <button type="submit">submit</button>

  </form>
</div>
  

<!-- show vendors -->
<ul id="vendor-list">
{% for vendor in vendors%}
<li>
    <h2>{{vendor.vendor_name}}</h2>
    <a href="/tacovendors/{{vendor.vendor_id}}"><img src="{{vendor.image}}" alt="image" class="tacoimage"></a>
    {% set _ = my_list.append(vendor.coords) %}
    {% set _ = business_name.append(vendor.vendor_name) %}
    {% set _ = vendorId.append(vendor.vendor_id) %}
    {% set _ = hours.append(vendor.working_hours) %}
    {% set _ = taco_icons.append(vendor.business_type) %}

    {% if vendor.vendor_id in rating_dic %}
        <p>Rating:{{rating_dic[vendor.vendor_id]}}</p>
    {% else %}
        <p>Rating:no ratings</p>
    {% endif %}
</li>
{% endfor %}
</ul>
<!-- hidden elements -->
<p id ="k" style="display:none" >{{my_list}}</p>
<p id ="business_name" style="display:none">{{business_name}}</p>
<p id="vendor_id" style="display:none">{{vendorId}}</p>
<p id="hours" style="display:none">{{hours}}</p>
<p id="business_type" style="display:none">{{taco_icons}}</p>
<br>
<!-- <p id="result"></p> -->

<div id="map"></div>

<script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD_6bTYpouO3j8eJSzy_Fx61zyZ9SknsXo&callback=initMap&v=weekly"
        defer
></script> 
<script>
  // converting strings into arrays
const str = document.getElementById("k").innerHTML;
const arr = JSON.parse(str.replace(/'/g, "\"")).map(coord => {
  const [lat, long] = coord.split(",");
  return { lat, long };
});

const business_title = document.getElementById("business_name").innerHTML;
var business_title_array=JSON.parse(business_title.replace(/'/g, "\""))

const vendor_ids = document.getElementById("vendor_id").innerHTML;
var vendor_ids_array=JSON.parse(vendor_ids.replace(/'/g, "\""))

const hours = document.getElementById("hours").innerHTML;
var hours_array=JSON.parse(hours.replace(/'/g, "\""))
const taco_icons = document.getElementById("business_type").innerHTML;
var taco_icons_array=JSON.parse(taco_icons.replace(/'/g, "\""))

// function for google maps
function initMap() {
  const map = new google.maps.Map(document.getElementById("map"), {
    zoom: 10,
    center: { lat: 37.3387, lng:  -121.8853 },
  });
  
  "https://img.icons8.com/officexs/15/null/taco.png"
  
  arr.forEach((coord,i) => {
    if( taco_icons_array[i] === 'taco truck'){
      var icon_image ="https://img.icons8.com/color/25/null/food-truck.png";
    }
    else if(taco_icons_array[i] === 'taco stand'){
      var icon_image ="https://img.icons8.com/officexs/25/null/taco.png";
    }

    const marker = new google.maps.Marker({
      position: { lat: Number(coord.lat), lng: Number(coord.long) },
      map,
      icon: {
        url: icon_image,
      },
      animation: google.maps.Animation.DROP
    });
    
    const infoWindow = new google.maps.InfoWindow({
      content: `<a href="/tacovendors/${vendor_ids_array[i]}"><h2>${business_title_array[i]}</h2></a><h2>Hours:${hours_array[i]}</h2>`
    });
    
    marker.addListener('click', () => {
      infoWindow.open(map, marker);
      map.setZoom(14);
      map.setCenter(marker.getPosition());
    }); 
  });
  
  return map;
}

window.initMap = initMap;
initMap();

 </script>

<script>
  var filter_button = document.querySelector(".filter-image")
  filter_button.addEventListener('click',(e)=>{
    document.getElementById("container-filter-business-type").className = "container-filter-display";
    document.getElementById("container-filters").classList.remove("container-filter-display");
  });
</script>
 

{% endblock %}





