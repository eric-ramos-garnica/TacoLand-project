
{% extends 'base.html'%}
{% block title %}Vendors page {% endblock %}

{% block head %}
<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
{% endblock %}

{% block body %}

<h1>All Vendors</h1>
{% set my_list = [] %}
{% set business_name = []%}
{% set vendorId = []%}
{% set hours = []%}
<ul id="vendor-list">
{% for vendor in vendors%}
<li>
    <h2>{{vendor.vendor_name}}</h2>
    <a href="/tacovendors/{{vendor.vendor_id}}"><img src="{{vendor.image}}" alt="image" class="tacoimage"></a>
    {% set _ = my_list.append(vendor.coords) %}
    {% set _ = business_name.append(vendor.vendor_name) %}
    {% set _ = vendorId.append(vendor.vendor_id) %}
    {% set _ = hours.append(vendor.working_hours) %}

    {% if vendor.vendor_id in rating_dic %}
        <p>Rating:{{rating_dic[vendor.vendor_id]}}</p>
    {% else %}
        <p>Rating:no ratings</p>
    {% endif %}
</li>
{% endfor %}
</ul>
<!-- hidden elements -->
<p id ="k" style="display:none" >{{my_list}}</p>
<p id ="business_name" style="display:none">{{business_name}}</p>
<p id="vendor_id" style="display:none">{{vendorId}}</p>
<p id="hours" style="display:none">{{hours}}</p>
<br>
<!-- <p id="result"></p> -->

<div id="map"></div>

<script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBeoOdd3zdS3zAfqGFF7o6X8N3hGvsa04o&callback=initMap&v=weekly"
        defer
></script> 
<script>
  // converting strings into arrays
const str = document.getElementById("k").innerHTML;
const arr = JSON.parse(str.replace(/'/g, "\"")).map(coord => {
  const [lat, long] = coord.split(",");
  return { lat, long };
});

const business_title = document.getElementById("business_name").innerHTML;
var business_title_array=JSON.parse(business_title.replace(/'/g, "\""))

const vendor_ids = document.getElementById("vendor_id").innerHTML;
var vendor_ids_array=JSON.parse(vendor_ids.replace(/'/g, "\""))

const hours = document.getElementById("hours").innerHTML;
var hours_array=JSON.parse(hours.replace(/'/g, "\""))

// function for google maps
function initMap() {
  const map = new google.maps.Map(document.getElementById("map"), {
    zoom: 10,
    center: { lat: 37.3387, lng:  -121.8853 },
  });
  
  arr.forEach((coord,i) => {
    const marker = new google.maps.Marker({
      position: { lat: Number(coord.lat), lng: Number(coord.long) },
      map,
      icon: {
        url: "https://img.icons8.com/officexs/15/null/taco.png",
      },
      animation: google.maps.Animation.DROP
    });
    
    const infoWindow = new google.maps.InfoWindow({
      content: `<a href="/tacovendors/${vendor_ids_array[i]}"><h2>${business_title_array[i]}</h2></a><h2>Hours:${hours_array[i]}</h2>`
    });
    
    marker.addListener('click', () => {
      infoWindow.open(map, marker);
      map.setZoom(14);
      map.setCenter(marker.getPosition());
    }); 
  });
  
  return map;
}

window.initMap = initMap;
initMap();
    
    
    
    </script>

{% endblock %}





