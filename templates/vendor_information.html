{% extends 'base.html'%}
{% block title %}Vendor page {% endblock %}

{% block head %}
<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD_6bTYpouO3j8eJSzy_Fx61zyZ9SknsXo&libraries=places"></script>

{% endblock %}

{% block body %}
<h1>Welcome to {{vendor_info.vendor_name}} </h1>
<img src="{{vendor_info.image}}" alt="image">
<p>Hours {{vendor_info.working_hours}}</p>
<p>address {{vendor_info.location}}</p>
{% if rating == 0 %}
    <p>Ratings:no rating</p>
{% else %}
    <p>Rating:{{rating}}</p>
{% endif %}

<div>
  <p>Make a rating</p>
  <a href="/rating/{{vendor_info.vendor_id}}"><button>rating</button></a>
</div> 
<hr>
<br>
<div>
   <div>
    <label for="origin">Origin:</label>
    <input type="text" id="origin" name="origin" placeholder="Type address">
    <i class="fa-solid fa-location-dot"></i>
  </div>
  <div>
    <label for="destination">Destination:</label>
    <input type="text" id="destination" value="{{vendor_info.location}}" name="destination">
    <i class="fa-solid fa-flag-checkered"></i>
  </div>
  <div>
    <button onclick="calculateRoute()">Calculate Route</button>
  </div>
</div>

<div>
  <!-- google maps -->
  <div id="map"></div>
  <!-- pannel for directions -->
  <div id="panel"></div>
</div>
<!-- output for google maps -->
<div id="output"></div>

 <!-- hidden elements -->
<p id="coord" style="display:none">{{vendor_info.coords}}</p>
<p id="hr" style="display:none">{{vendor_info.working_hours}}</p>
<p id="rating" style="display:none">{{rating}}</p>
<p id="taco-icon" style="display:none">{{vendor_info.business_type}}</p>


<script
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD_6bTYpouO3j8eJSzy_Fx61zyZ9SknsXo&callback=initMap&v=weekly"
  defer
></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD_6bTYpouO3j8eJSzy_Fx61zyZ9SknsXo&libraries=places"></script>

<script>
var map;
const coordinate = document.getElementById("coord").innerHTML.split(","); 
const hr = document.getElementById("hr").innerHTML; 
const rating = document.getElementById("rating").innerHTML;
const business_type = document.getElementById("taco-icon").innerHTML;


function initMap() {

  var coords = document.getElementById('coord').innerHTML.split(',');
  var latLng = { lat: parseFloat(coords[0]), lng: parseFloat(coords[1]) };

  map = new google.maps.Map(document.getElementById('map'), {
    center: latLng,
    zoom: 13
  });
   
  if( business_type=== 'taco truck'){
      var icon_image ="https://img.icons8.com/color/25/null/food-truck.png";
    }
  else if(business_type === 'taco stand'){
      var icon_image ="https://img.icons8.com/officexs/25/null/taco.png";
    }

  var marker = new google.maps.Marker({
    position: latLng,
    map: map,
    icon:{
        url: icon_image,
      },
      animation: google.maps.Animation.DROP
  });

  var infoWindow = new google.maps.InfoWindow({
      content:`<a href="#"><h2>Tacos el Gordo</h2></a><h2>Hours:${hr}<h2><h2>Rating:${rating}</h2>`
    });
    marker.addListener('click',function(){
      infoWindow.open(map,marker)
      map.setZoom(14);
      // map.setCenter(marker.getPosition());
    });

    const defaultBounds = {
    north: center.lat + 0.1,
    south: center.lat - 0.1,
    east: center.lng + 0.1,
    west: center.lng - 0.1,
  };

}


function calculateRoute() {
  var origin = document.getElementById('origin').value;
  var destination = document.getElementById('destination').value;

  var directionsService = new google.maps.DirectionsService();
  var directionsRenderer = new google.maps.DirectionsRenderer({ 
    // draggable:true,   //i commented this  so the route wont be draggable.
    panel: document.getElementById("panel"),
  });

  directionsRenderer.addListener("directions_changed", ()=>{
    const directions = directionsRenderer.getDirections();

  });

  displayRoute(origin,destination,directionsService,directionsRenderer);


  directionsRenderer.setMap(map);

  directionsService.route(
    {
      origin: origin,
      destination: destination,
      travelMode: google.maps.TravelMode.DRIVING
    },
    function(response, status) {
      if (status === 'OK') {
        const output = document.querySelector('#output');
        output.innerHTML = "<div class='alert-info'> From: " + document.getElementById("origin").value + ".<br>To: " + document.getElementById("destination").value + ".<br>Driving distance <i class='fa-solid fa-road'></i>" + response.routes[0].legs[0].distance.text + ".<br>Duration <i class='fa-solid fa-hourglass-half'></i> : " + response.routes[0].legs[0].duration.text + ". </div>" ;
        directionsRenderer.setDirections(response);
      } else {
        window.alert('Directions request failed due to ' + status);
      }
    });
    
  }
   
function displayRoute(origin, destination,service,display){
  service.route({
    origin:origin,
    destination:destination,
    travelMode:google.maps.TravelMode.DRIVING,
    avoidTolls: true,
  })
  .then(function(result){
    display.setDirections(result);
  })
  .catch(function(e) {
    alert("Could not display directions due to: " + e)
  });
}
</script>




{% endblock %}